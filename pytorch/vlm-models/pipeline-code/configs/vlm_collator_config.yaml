# VLM Data Collator Configuration
# ë‹¤ì–‘í•œ VLM ëª¨ë¸ê³¼ ë°ì´í„°ì…‹ì— ëŒ€í•œ data collator ì„¤ì •

# ë°ì´í„°ì…‹ë³„ ì»¬ëŸ¼ ë§¤í•‘
dataset_columns:
    # ê¸°ë³¸ VQA ë°ì´í„°ì…‹ êµ¬ì¡°
    image_column: "image" # ì´ë¯¸ì§€ ì»¬ëŸ¼ëª…
    question_column: "question" # ì§ˆë¬¸ ì»¬ëŸ¼ëª…
    answer_column: "multiple_choice_answer" # ë‹µë³€ ì»¬ëŸ¼ëª…

    # ì¶”ê°€ ì»¬ëŸ¼ë“¤ (ì„ íƒì‚¬í•­)
    context_column: null # ì»¨í…ìŠ¤íŠ¸ ì •ë³´
    metadata_column: null # ë©”íƒ€ë°ì´í„°
    video_column: "video" # ë¹„ë””ì˜¤ ì»¬ëŸ¼ëª… (ìƒˆë¡œ ì¶”ê°€)

# ë©”ì‹œì§€ í¬ë§· í…œí”Œë¦¿
message_format:
    system_prompt: "Answer briefly."

    # í•™ìŠµìš© ë©”ì‹œì§€ êµ¬ì¡° (user + assistant)
    training_messages:
        - role: "user"
          content:
              - type: "text"
                text: "{system_prompt}"
              - type: "image"
              - type: "text"
                text: "{question}"
        - role: "assistant"
          content:
              - type: "text"
                text: "{answer}"

    # í‰ê°€ìš© ë©”ì‹œì§€ êµ¬ì¡° (userë§Œ, generation_prompt=True)
    evaluation_messages:
        - role: "user"
          content:
              - type: "text"
                text: "{system_prompt}"
              - type: "image"
              - type: "text"
                text: "{question}"

# ë°ì´í„° íƒ€ì…ë³„ ì²˜ë¦¬ í™œì„±í™” ì„¤ì •
data_processing:
    image_data: true # ì´ë¯¸ì§€ ë°ì´í„° ì²˜ë¦¬ í™œì„±í™” ì—¬ë¶€ (ê¸°ë³¸ê°’: true)
    video_data: false # ë¹„ë””ì˜¤ ë°ì´í„° ì²˜ë¦¬ í™œì„±í™” ì—¬ë¶€ (ê¸°ë³¸ê°’: false)

# ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ì„¤ì •
image_processing:
    convert_to_rgb: true # RGBë¡œ ë³€í™˜ ì—¬ë¶€
    resize_mode: "keep_aspect" # ë¦¬ì‚¬ì´ì¦ˆ ëª¨ë“œ: keep_aspect, crop, stretch
    max_size: null # ìµœëŒ€ í¬ê¸° ì œí•œ (ì„ íƒì‚¬í•­)

# í…ìŠ¤íŠ¸ ì²˜ë¦¬ ì„¤ì •
text_processing:
    padding: true # íŒ¨ë”© ì ìš© ì—¬ë¶€
    truncation: true # ìë¥´ê¸° ì ìš© ì—¬ë¶€
    max_length: 2048 # ìµœëŒ€ ê¸¸ì´
    add_generation_prompt: false # í•™ìŠµì‹œ generation prompt ì¶”ê°€ ì—¬ë¶€

# ë ˆì´ë¸” ë§ˆìŠ¤í‚¹ ì„¤ì •
label_masking:
    mask_pad_token: true # íŒ¨ë”© í† í° ë§ˆìŠ¤í‚¹
    mask_image_token: true # ì´ë¯¸ì§€ í† í° ë§ˆìŠ¤í‚¹
    mask_input_tokens: false # ì…ë ¥ í† í° ë§ˆìŠ¤í‚¹ (instruction tuningì‹œ false)
    ignore_index: -100 # ë§ˆìŠ¤í‚¹ëœ í† í°ì˜ ë¼ë²¨ ê°’

# ë°°ì¹˜ ì²˜ë¦¬ ì„¤ì •
batch_processing:
    return_tensors: "pt" # ë°˜í™˜í•  í…ì„œ íƒ€ì…
    padding_strategy: "longest" # íŒ¨ë”© ì „ëµ: longest, max_length

# íŠ¹ìˆ˜ í† í° ì„¤ì • (ìë™ ê°ì§€ ì‚¬ìš©, ìˆ˜ë™ ì„¤ì • ë¶ˆí•„ìš”)
special_tokens:
    # âœ¨ ìƒˆë¡œìš´ ìë™ ê°ì§€ ì‹œìŠ¤í…œ âœ¨
    # ì´ì œ tokenizer.special_tokens_mapê³¼ additional_special_tokensì—ì„œ
    # ëª¨ë“  íŠ¹ìˆ˜ í† í°ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ë¯€ë¡œ ìˆ˜ë™ ì„¤ì •ì´ ë¶ˆí•„ìš”í•©ë‹ˆë‹¤!

    # ğŸ”§ ê¸°ë³¸ ë™ì‘:
    # - íŒ¨ë“œ, EOS, BOS ë“± core í† í°ë“¤ ìë™ ê°ì§€
    # - ì´ë¯¸ì§€, ë¹„ë””ì˜¤ ë“± VLM ê´€ë ¨ í† í°ë“¤ ìë™ ê°ì§€
    # - apply_chat_templateê³¼ í˜¸í™˜ì„± ìë™ ê²€ì¦
    # - ì†ì‹¤ ê³„ì‚° ì‹œ ìë™ ë§ˆìŠ¤í‚¹ ì ìš©

    # ğŸ“ Manual override (ì„ íƒì‚¬í•­ - ê³ ê¸‰ ì‚¬ìš©ììš©)
    # ìë™ ê°ì§€ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ì—ë§Œ ì•„ë˜ ì„¹ì…˜ì„ í™œì„±í™”í•˜ì„¸ìš”
    manual_tokens:
        enabled: false # trueë¡œ ë³€ê²½ì‹œ ìˆ˜ë™ í† í° ì„¤ì • í™œì„±í™”
        tokens:
            []
            # ì˜ˆì‹œ (í•„ìš”ì‹œì—ë§Œ ì‚¬ìš©):
            # - name: "custom_image_token"
            #   token: "<custom_image>"
            #   ignore_in_loss: true

# ë¹„ë””ì˜¤ ì²˜ë¦¬ ì„¤ì •
video_processing:
    enabled: true # ë¹„ë””ì˜¤ ì²˜ë¦¬ í™œì„±í™” ì—¬ë¶€

    # í”„ë ˆì„ ì¶”ì¶œ ë° ìƒ˜í”Œë§ ì„¤ì •
    frame_extraction:
        library: "decord" # ë¹„ë””ì˜¤ ë¡œë”© ë¼ì´ë¸ŒëŸ¬ë¦¬ (decord ê¶Œì¥)
        sampling_strategy: "uniform" # ìƒ˜í”Œë§ ì „ëµ (uniform: ê· ë“± ìƒ˜í”Œë§)
        num_frames: 8 # ì¶”ì¶œí•  í”„ë ˆì„ ìˆ˜

    # ë¹„ë””ì˜¤ íŒŒì¼ ì²˜ë¦¬ ì„¤ì •
    file_processing:
        convert_to_rgb: true # RGB ë³€í™˜ ì—¬ë¶€
        max_duration: null # ìµœëŒ€ ë¹„ë””ì˜¤ ê¸¸ì´ (ì´ˆ, null=ì œí•œì—†ìŒ)
