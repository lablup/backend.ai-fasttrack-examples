# VLM Data Collator Configuration
# 다양한 VLM 모델과 데이터셋에 대한 data collator 설정

# 데이터셋별 컬럼 매핑
dataset_columns:
    # 기본 VQA 데이터셋 구조
    image_column: "image" # 이미지 컬럼명
    question_column: "question" # 질문 컬럼명
    answer_column: "multiple_choice_answer" # 답변 컬럼명

    # 추가 컬럼들 (선택사항)
    context_column: null # 컨텍스트 정보
    metadata_column: null # 메타데이터
    video_column: "video" # 비디오 컬럼명 (새로 추가)

# 메시지 포맷 템플릿
message_format:
    system_prompt: "Answer briefly."

    # 학습용 메시지 구조 (user + assistant)
    training_messages:
        - role: "user"
          content:
              - type: "text"
                text: "{system_prompt}"
              - type: "image"
              - type: "text"
                text: "{question}"
        - role: "assistant"
          content:
              - type: "text"
                text: "{answer}"

    # 평가용 메시지 구조 (user만, generation_prompt=True)
    evaluation_messages:
        - role: "user"
          content:
              - type: "text"
                text: "{system_prompt}"
              - type: "image"
              - type: "text"
                text: "{question}"

# 데이터 타입별 처리 활성화 설정
data_processing:
    image_data: true # 이미지 데이터 처리 활성화 여부 (기본값: true)
    video_data: false # 비디오 데이터 처리 활성화 여부 (기본값: false)

# 이미지 전처리 설정
image_processing:
    convert_to_rgb: true # RGB로 변환 여부
    resize_mode: "keep_aspect" # 리사이즈 모드: keep_aspect, crop, stretch
    max_size: null # 최대 크기 제한 (선택사항)

# 비디오 처리 설정
video_processing:
    enabled: true # 비디오 처리 활성화 여부

    # 프레임 추출 및 샘플링 설정
    frame_extraction:
        library: "decord" # 비디오 로딩 라이브러리 (decord 권장)
        sampling_strategy: "uniform" # 샘플링 전략 (uniform: 균등 샘플링)
        num_frames: 8 # 추출할 프레임 수

    # 비디오 파일 처리 설정
    file_processing:
        convert_to_rgb: true # RGB 변환 여부
        max_duration: null # 최대 비디오 길이 (초, null=제한없음)

# 텍스트 처리 설정
text_processing:
    padding: true # 패딩 적용 여부
    truncation: true # 자르기 적용 여부
    max_length: 2048 # 최대 길이
    add_generation_prompt: false # 학습시 generation prompt 추가 여부

# 레이블 마스킹 설정
label_masking:
    mask_pad_token: true # 패딩 토큰 마스킹
    mask_image_token: true # 이미지 토큰 마스킹
    mask_input_tokens: false # 입력 토큰 마스킹 (instruction tuning시 false)
    ignore_index: -100 # 마스킹된 토큰의 라벨 값

# 배치 처리 설정
batch_processing:
    return_tensors: "pt" # 반환할 텐서 타입
    padding_strategy: "longest" # 패딩 전략: longest, max_length
